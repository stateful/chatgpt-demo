import superagent from 'superagent';
export const apiCall = (api, json) => {
    const headers = {
        Authorization: `Bearer ${api.key}`,
        ...api.headers,
    };
    return new Promise(function (resolve) {
        return superagent
            .post(new URL(api.name, api.url).href)
            .send(json)
            .set(headers)
            .type('json')
            .accept('json')
            .retry(3)
            .then(({ body: data }) => resolve(data));
    });
};
export const apiCallWithUpload = (api, json, file) => {
    const headers = {
        Authorization: `Bearer ${api.key}`,
        ...api.headers,
    };
    return new Promise(function (resolve) {
        if (file) {
            let sa = superagent
                .post(new URL(api.name, api.url).href)
                .retry(3)
                .attach('file', file)
                .set(headers);
            let k;
            for (k in json) {
                if (json[k]) {
                    sa = sa.field(k, json[k]);
                }
            }
            return sa.then(({ body: data }) => resolve(data));
        }
    });
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9haS91dGlsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sVUFBVSxNQUFNLFlBQVksQ0FBQztBQVNwQyxNQUFNLENBQUMsTUFBTSxPQUFPLEdBQUcsQ0FDckIsR0FBWSxFQUNaLElBQWEsRUFDTSxFQUFFO0lBQ3JCLE1BQU0sT0FBTyxHQUFHO1FBQ2QsYUFBYSxFQUFFLFVBQVUsR0FBRyxDQUFDLEdBQUcsRUFBRTtRQUNsQyxHQUFHLEdBQUcsQ0FBQyxPQUFPO0tBQ2YsQ0FBQztJQUVGLE9BQU8sSUFBSSxPQUFPLENBQUMsVUFBVSxPQUFPO1FBQ2xDLE9BQU8sVUFBVTthQUNkLElBQUksQ0FBQyxJQUFJLEdBQUcsQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7YUFDckMsSUFBSSxDQUFDLElBQUksQ0FBQzthQUNWLEdBQUcsQ0FBQyxPQUFPLENBQUM7YUFDWixJQUFJLENBQUMsTUFBTSxDQUFDO2FBQ1osTUFBTSxDQUFDLE1BQU0sQ0FBQzthQUNkLEtBQUssQ0FBQyxDQUFDLENBQUM7YUFDUixJQUFJLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDN0MsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUM7QUFFRixNQUFNLENBQUMsTUFBTSxpQkFBaUIsR0FBRyxDQUMvQixHQUFZLEVBQ1osSUFBYSxFQUNiLElBQVksRUFDTyxFQUFFO0lBQ3JCLE1BQU0sT0FBTyxHQUFHO1FBQ2QsYUFBYSxFQUFFLFVBQVUsR0FBRyxDQUFDLEdBQUcsRUFBRTtRQUNsQyxHQUFHLEdBQUcsQ0FBQyxPQUFPO0tBQ2YsQ0FBQztJQUVGLE9BQU8sSUFBSSxPQUFPLENBQUMsVUFBVSxPQUFPO1FBQ2xDLElBQUksSUFBSSxFQUFFO1lBQ1IsSUFBSSxFQUFFLEdBQUcsVUFBVTtpQkFDaEIsSUFBSSxDQUFDLElBQUksR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztpQkFDckMsS0FBSyxDQUFDLENBQUMsQ0FBQztpQkFDUixNQUFNLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQztpQkFDcEIsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBRWhCLElBQUksQ0FBZ0IsQ0FBQztZQUNyQixLQUFLLENBQUMsSUFBSSxJQUFJLEVBQUU7Z0JBQ2QsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUU7b0JBQ1gsRUFBRSxHQUFHLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2lCQUMzQjthQUNGO1lBRUQsT0FBTyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1NBQ25EO0lBQ0gsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMifQ==