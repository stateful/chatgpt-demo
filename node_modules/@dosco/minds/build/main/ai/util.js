"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.apiCallWithUpload = exports.apiCall = void 0;
const superagent_1 = __importDefault(require("superagent"));
const apiCall = (api, json) => {
    const headers = Object.assign({ Authorization: `Bearer ${api.key}` }, api.headers);
    return new Promise(function (resolve) {
        return superagent_1.default
            .post(new URL(api.name, api.url).href)
            .send(json)
            .set(headers)
            .type('json')
            .accept('json')
            .retry(3)
            .then(({ body: data }) => resolve(data));
    });
};
exports.apiCall = apiCall;
const apiCallWithUpload = (api, json, file) => {
    const headers = Object.assign({ Authorization: `Bearer ${api.key}` }, api.headers);
    return new Promise(function (resolve) {
        if (file) {
            let sa = superagent_1.default
                .post(new URL(api.name, api.url).href)
                .retry(3)
                .attach('file', file)
                .set(headers);
            let k;
            for (k in json) {
                if (json[k]) {
                    sa = sa.field(k, json[k]);
                }
            }
            return sa.then(({ body: data }) => resolve(data));
        }
    });
};
exports.apiCallWithUpload = apiCallWithUpload;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9haS91dGlsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLDREQUFvQztBQVM3QixNQUFNLE9BQU8sR0FBRyxDQUNyQixHQUFZLEVBQ1osSUFBYSxFQUNNLEVBQUU7SUFDckIsTUFBTSxPQUFPLG1CQUNYLGFBQWEsRUFBRSxVQUFVLEdBQUcsQ0FBQyxHQUFHLEVBQUUsSUFDL0IsR0FBRyxDQUFDLE9BQU8sQ0FDZixDQUFDO0lBRUYsT0FBTyxJQUFJLE9BQU8sQ0FBQyxVQUFVLE9BQU87UUFDbEMsT0FBTyxvQkFBVTthQUNkLElBQUksQ0FBQyxJQUFJLEdBQUcsQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7YUFDckMsSUFBSSxDQUFDLElBQUksQ0FBQzthQUNWLEdBQUcsQ0FBQyxPQUFPLENBQUM7YUFDWixJQUFJLENBQUMsTUFBTSxDQUFDO2FBQ1osTUFBTSxDQUFDLE1BQU0sQ0FBQzthQUNkLEtBQUssQ0FBQyxDQUFDLENBQUM7YUFDUixJQUFJLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDN0MsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUM7QUFuQlcsUUFBQSxPQUFPLFdBbUJsQjtBQUVLLE1BQU0saUJBQWlCLEdBQUcsQ0FDL0IsR0FBWSxFQUNaLElBQWEsRUFDYixJQUFZLEVBQ08sRUFBRTtJQUNyQixNQUFNLE9BQU8sbUJBQ1gsYUFBYSxFQUFFLFVBQVUsR0FBRyxDQUFDLEdBQUcsRUFBRSxJQUMvQixHQUFHLENBQUMsT0FBTyxDQUNmLENBQUM7SUFFRixPQUFPLElBQUksT0FBTyxDQUFDLFVBQVUsT0FBTztRQUNsQyxJQUFJLElBQUksRUFBRTtZQUNSLElBQUksRUFBRSxHQUFHLG9CQUFVO2lCQUNoQixJQUFJLENBQUMsSUFBSSxHQUFHLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO2lCQUNyQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2lCQUNSLE1BQU0sQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDO2lCQUNwQixHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7WUFFaEIsSUFBSSxDQUFnQixDQUFDO1lBQ3JCLEtBQUssQ0FBQyxJQUFJLElBQUksRUFBRTtnQkFDZCxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRTtvQkFDWCxFQUFFLEdBQUcsRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7aUJBQzNCO2FBQ0Y7WUFFRCxPQUFPLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7U0FDbkQ7SUFDSCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQztBQTVCVyxRQUFBLGlCQUFpQixxQkE0QjVCIn0=