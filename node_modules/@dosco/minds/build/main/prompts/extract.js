"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.ExtractInfoPrompt = exports.BusinessInfo = void 0;
const flow_1 = __importDefault(require("lodash/fp/flow"));
const uniqBy_1 = __importDefault(require("lodash/fp/uniqBy"));
const reject_1 = __importDefault(require("lodash/fp/reject"));
const uniq_1 = __importDefault(require("lodash/fp/uniq"));
const map_1 = __importDefault(require("lodash/fp/map"));
const join_1 = __importDefault(require("lodash/fp/join"));
const isEmpty_1 = __importDefault(require("lodash/fp/isEmpty"));
var BusinessInfo;
(function (BusinessInfo) {
    // Product stuff
    BusinessInfo["ProductName"] = "Product Name";
    BusinessInfo["ProductDescription"] = "Product Description";
    BusinessInfo["ProductModelNumber"] = "Product Model Number";
    BusinessInfo["ProductSerialNumber"] = "Product Serial Number";
    BusinessInfo["ProductPurchaseDate"] = "Product Purchase Date";
    // Purchases
    BusinessInfo["OrderID"] = "Order ID";
    BusinessInfo["OrderQuantity"] = "Order Quantity";
    BusinessInfo["AccountNumber"] = "Account Number";
    BusinessInfo["ShippingAddress"] = "Shipping Address";
    BusinessInfo["BillingAddress"] = "Billing Address";
    BusinessInfo["PaymentMethod"] = "Payment method";
    // SupportInfo
    BusinessInfo["CustomerName"] = "Senders Name";
    BusinessInfo["CustomerEmail"] = "Senders Email";
    BusinessInfo["CustomerPhone"] = "Senders Phone";
    BusinessInfo["ContactInformation"] = "Sender Contact Information";
    BusinessInfo["IssueClass"] = "Issue Class";
    BusinessInfo["IssueDescription"] = "Issue Description";
    BusinessInfo["IssueSummary"] = "Issue Summary";
    BusinessInfo["ErrorMessage"] = "Error Message";
    BusinessInfo["TroubleshootingStepsTaken"] = "Troubleshooting Steps Taken";
    BusinessInfo["SupportTicketNumber"] = "Support Ticket Number";
    BusinessInfo["SupportAgentName"] = "Support Agent Name";
    BusinessInfo["Feedback"] = "Feedback";
    BusinessInfo["OrderDetailsIncluded"] = "Order Details Included";
    BusinessInfo["ShippingDetailsIncluded"] = "Shipping Details Included";
    BusinessInfo["Priority"] = "Priority";
})(BusinessInfo = exports.BusinessInfo || (exports.BusinessInfo = {}));
/**
 * A prompt used for extracting information from customer support interactions
 * @export
 */
class ExtractInfoPrompt {
    constructor(entities) {
        if ((0, isEmpty_1.default)(entities)) {
            throw new Error(`No info defined to extract`);
        }
        // unique names and classes
        this.entityValue = (0, flow_1.default)((0, reject_1.default)((v) => v.name === 'Text'), (0, map_1.default)((v) => { var _a; return (Object.assign(Object.assign({}, v), { name: (_a = v.name) === null || _a === void 0 ? void 0 : _a.trim().replace(/[^a-zA-Z ]+/, '') })); }), (0, uniqBy_1.default)((v) => v.name), (0, map_1.default)((v) => (v.classes ? [v.name, (0, join_1.default)((0, uniq_1.default)(v.classes), ',')] : [v.name])), (0, map_1.default)(([n, c]) => `${n}:${c ? ` [${c}]` : ``}`), (0, join_1.default)('\n'))(entities);
    }
    metadata() {
        return {
            stopSequences: ['Text:'],
            keyValueResponse: true,
        };
    }
    create(query, _history, _ai) {
        return `
Extract the following entities mentioned in the text below. Use N/A if entity is not found::
${this.entityValue}

Text: 
${query}
`;
    }
}
exports.ExtractInfoPrompt = ExtractInfoPrompt;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXh0cmFjdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9wcm9tcHRzL2V4dHJhY3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQ0EsMERBQWtDO0FBQ2xDLDhEQUFzQztBQUN0Qyw4REFBc0M7QUFDdEMsMERBQWtDO0FBQ2xDLHdEQUFnQztBQUNoQywwREFBa0M7QUFDbEMsZ0VBQXdDO0FBRXhDLElBQVksWUFnQ1g7QUFoQ0QsV0FBWSxZQUFZO0lBQ3RCLGdCQUFnQjtJQUNoQiw0Q0FBNEIsQ0FBQTtJQUM1QiwwREFBMEMsQ0FBQTtJQUMxQywyREFBMkMsQ0FBQTtJQUMzQyw2REFBNkMsQ0FBQTtJQUM3Qyw2REFBNkMsQ0FBQTtJQUU3QyxZQUFZO0lBQ1osb0NBQW9CLENBQUE7SUFDcEIsZ0RBQWdDLENBQUE7SUFDaEMsZ0RBQWdDLENBQUE7SUFDaEMsb0RBQW9DLENBQUE7SUFDcEMsa0RBQWtDLENBQUE7SUFDbEMsZ0RBQWdDLENBQUE7SUFFaEMsY0FBYztJQUNkLDZDQUE2QixDQUFBO0lBQzdCLCtDQUErQixDQUFBO0lBQy9CLCtDQUErQixDQUFBO0lBQy9CLGlFQUFpRCxDQUFBO0lBQ2pELDBDQUEwQixDQUFBO0lBQzFCLHNEQUFzQyxDQUFBO0lBQ3RDLDhDQUE4QixDQUFBO0lBQzlCLDhDQUE4QixDQUFBO0lBQzlCLHlFQUF5RCxDQUFBO0lBQ3pELDZEQUE2QyxDQUFBO0lBQzdDLHVEQUF1QyxDQUFBO0lBQ3ZDLHFDQUFxQixDQUFBO0lBQ3JCLCtEQUErQyxDQUFBO0lBQy9DLHFFQUFxRCxDQUFBO0lBQ3JELHFDQUFxQixDQUFBO0FBQ3ZCLENBQUMsRUFoQ1csWUFBWSxHQUFaLG9CQUFZLEtBQVosb0JBQVksUUFnQ3ZCO0FBT0Q7OztHQUdHO0FBQ0gsTUFBYSxpQkFBaUI7SUFHNUIsWUFBWSxRQUF5QjtRQUNuQyxJQUFJLElBQUEsaUJBQU8sRUFBQyxRQUFRLENBQUMsRUFBRTtZQUNyQixNQUFNLElBQUksS0FBSyxDQUFDLDRCQUE0QixDQUFDLENBQUM7U0FDL0M7UUFFRCwyQkFBMkI7UUFDM0IsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFBLGNBQUksRUFDckIsSUFBQSxnQkFBTSxFQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxLQUFLLE1BQU0sQ0FBQyxFQUNoQyxJQUFBLGFBQUcsRUFBQyxDQUFDLENBQUMsRUFBRSxFQUFFLFdBQUMsT0FBQSxpQ0FBTSxDQUFDLEtBQUUsSUFBSSxFQUFFLE1BQUEsQ0FBQyxDQUFDLElBQUksMENBQUUsSUFBSSxHQUFHLE9BQU8sQ0FBQyxhQUFhLEVBQUUsRUFBRSxDQUFDLElBQUcsQ0FBQSxFQUFBLENBQUMsRUFDdkUsSUFBQSxnQkFBTSxFQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQ3JCLElBQUEsYUFBRyxFQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxJQUFBLGNBQUksRUFBQyxJQUFBLGNBQUksRUFBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUN6RSxJQUFBLGFBQUcsRUFBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLEVBQzdDLElBQUEsY0FBSSxFQUFDLElBQUksQ0FBQyxDQUNYLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDZCxDQUFDO0lBRUQsUUFBUTtRQUNOLE9BQU87WUFDTCxhQUFhLEVBQUUsQ0FBQyxPQUFPLENBQUM7WUFDeEIsZ0JBQWdCLEVBQUUsSUFBSTtTQUN2QixDQUFDO0lBQ0osQ0FBQztJQUVELE1BQU0sQ0FBQyxLQUFhLEVBQUUsUUFBc0IsRUFBRSxHQUFjO1FBQzFELE9BQU87O0VBRVQsSUFBSSxDQUFDLFdBQVc7OztFQUdoQixLQUFLO0NBQ04sQ0FBQztJQUNBLENBQUM7Q0FDRjtBQW5DRCw4Q0FtQ0MifQ==